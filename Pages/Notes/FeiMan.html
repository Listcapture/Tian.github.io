<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>计算机组成原理</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/latex.js/dist/latex.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="./FeiMan.css">

    <style>
        .problem {
            font-weight: bold;
            font-family: "Times New Roman", serif;
        }

        .answer {
            font-family: Arial, sans-serif; /* Default font for answers */
        }

        #answerColorPicker {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
</head>

<body>
    <!-- Background Image Selector -->
    <select id="backgroundSelector" onchange="changeBackground()">
        <option value="url('https://www.gstatic.com/webp/gallery/1.jpg')">Image 1</option>
        <!-- <option value="url('https://www.gstatic.com/webp/gallery/2.jpg')">Image 2</option>
        <option value="url('https://www.gstatic.com/webp/gallery/3.jpg')">Image 3</option>
        <option value="url('https://www.gstatic.com/webp/gallery/4.jpg')">Image 4</option>
        <option value="url('https://www.gstatic.com/webp/gallery/5.jpg')">Image 5</option> -->
    </select>

    <!-- Background Image Container -->
    <div id="background"></div>

    <input type="color" id="answerColorPicker" onchange="changeAnswerColor(this.value)" value="#000000">

    <div id="content">
        <div id="latex-text">
            
            <h1>计算机组成原理</h1>
        </div>
    </div>

    <script>
        function renderPlainText(text, element) {
            element.textContent = text;
        }

        function renderMath(text, element) {
            element.textContent = ''; // 清空内容
            element.innerHTML = text; // 使用innerHTML而不是textContent
            MathJax.typesetPromise([element]).catch((err) => {
                console.log('Typeset failed: ' + err);
            });
        }

        function toggleAnswer(answerDiv, button) {
            if (answerDiv.style.display === "none") {
                answerDiv.style.display = "block";
                button.textContent = "隐藏答案";
            } else {
                answerDiv.style.display = "none";
                button.textContent = "查看答案";
            }
        }

        function fetchDataFromExcel(url) {
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    let rows = data.split('\n');

                    let contentDiv = document.getElementById("content");

                    rows.forEach(row => {
                        let columns = row.split(',');
                        let problem = columns[0];
                        let answer = columns[1];

                        if (problem && answer) {
                            let problemDiv = document.createElement("div");
                            problemDiv.className = "problem";

                            renderPlainText(problem, problemDiv);
                            contentDiv.appendChild(problemDiv);


                            let answerDiv = document.createElement("div");
                            answerDiv.className = "answer";
                            renderMath(answer, answerDiv); // 渲染 LaTeX 公式
                            contentDiv.appendChild(answerDiv);

                            let showAnswerButton = document.createElement("button");
                            showAnswerButton.textContent = "查看答案";
                            showAnswerButton.className = "show-answer-button";
                            showAnswerButton.onclick = function () {
                                toggleAnswer(answerDiv, showAnswerButton);
                            };
                            contentDiv.appendChild(showAnswerButton);

                            contentDiv.appendChild(document.createElement("hr"));
                        }
                    });
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        fetchDataFromExcel("./UTF-8-FeiManX.csv");
        setTimeout(() => {
            changeBackground();
        }, 200);

        // Function to change background image
        function changeBackground() {
            var selector = document.getElementById("backgroundSelector");
            var background = document.getElementById("background");
            var selectedValue = selector.value;

            background.style.backgroundImage = selectedValue;
        }

        // Function to change answer text color
        function changeAnswerColor(color) {
            var answerDivs = document.getElementsByClassName("answer");
            for (var i = 0; i < answerDivs.length; i++) {
                answerDivs[i].style.color = color;
            }
        }

        // 渲染 LaTeX 公式
        MathJax.typesetPromise().then(() => {
            const latexText = document.getElementById('answer-1');
            const FinalText = latexjs.parse(latexText.text);
            FinalText.style.visibility = 'visible'; // 防止 MathJax 渲染前的闪烁
            const latexText2 = document.getElementsByClassName('answer');
            latexText2.style.visibility = 'visible'; // 防止 MathJax 渲染前的闪烁
        });
    </script>
</body>
